!function(){"use strict";const e=(...e)=>{let t=e;3===t.length&&(t=[[document.documentElement],...t]),"String"===t[0].constructor.name?t[0]=[...document.querySelectorAll(t[0])]:t[0].forEach?t[0]=[...t[0]]:t[0]=[t[0]],"String"!==t[2].constructor.name&&(t[2].forEach?t[2]=[...t[2]]:t[2]=[t[2]]);const[n,o,i,c]=t,s=o.split(" "),a=e=>{let t;"String"===i.constructor.name?t=e.target.closest(i):[t]=i.filter((t=>t===e.target||t.contains(e.target))),t&&(e.relatedElements=n,c.call(t,e,t))};return n.forEach((e=>{s.forEach((t=>{e.addEventListener(t,a,!0)}))})),a};var t=document,n="getElementsByClassName",o=function(e){return t.querySelectorAll(e)},i="OK",c="Cancel",s=["dialog","toast","loading","iframe"],a={type:0,mask:!0,maskClose:!0,closebtn:!0,whenBtnClickClose:!0,fixed:!0,anim:"def"},l={extend:function(e,t){var n="object"==typeof t?JSON.parse(JSON.stringify(t)):JSON.parse(JSON.stringify(a));for(var o in e)n[o]=e[o];return n},timer:{},end:{},touch:function(e,t){e.addEventListener("click",(function(e){t.call(this,e)}),!1)}},r=0,d=["wbui"],u=function(e){this.config=l.extend(e),this.view()};u.prototype.view=function(){var e=this,i=e.config,c=t.createElement("div"),a="object"==typeof i.content,l="string"==typeof i.type?i.type:d[0]+"-"+s[i.type||0];e.id=c.id=d[0]+r,c.setAttribute("class",d[0]+" "+l),c.setAttribute("index",r);var u,y,f=(u="object"==typeof i.title,i.title?'<h3 class="wbui-title'+(u?" "+i.title[1]:"")+'">'+(u?i.title[0]:i.title)+"</h3>":""),v=(y="object"==typeof i.closebtn,i.closebtn?'<a class="wbui-close'+(y?" "+i.closetype[1]:"")+'"><i></i></a>':""),m=function(){"string"==typeof i.btn&&(i.btn=[i.btn]);var e,t=(i.btn||[]).length;return 0!==t&&i.btn?(e='<span yes type="1">'+i.btn[0]+"</span>",2===t&&(e='<span no type="0">'+i.btn[1]+"</span>"+e),'<div class="wbui-btn">'+e+"</div>"):""}();if(i.fixed||(i.top=i.hasOwnProperty("top")?i.top:100,i.style=i.style||"",i.style+=" top:"+(t.body.scrollTop+i.top)+"px"),2===i.type&&(i.content='<i></i><i class="wbui-load"></i><i></i><p>'+(i.content||"")+"</p>"),3===i.type){i.content=a?i.content:[i.content||"","auto"];i.content='<iframe scrolling="'+(i.content[1]||"auto")+'" allowtransparency="true" id="'+s[3]+r+'" name="'+s[3]+r+'" onload="this.className=\'\';" class="wbui-load" frameborder="0" src="'+i.content[0]+'"></iframe>'}if(i.skin&&(i.anim="fade"),"msg"===i.skin&&(i.mask=i.closebtn=!1,i.time=2),c.innerHTML=(i.mask?"<div "+("string"==typeof i.mask?'style="'+i.mask+'"':"")+' class="wbui-mask"></div>':"")+'<div class="wbui-main" '+(i.fixed?"":'style="position:static;"')+'><div class="wbui-section"><div class="wbui-child '+(i.skin?"wbui-"+i.skin+" ":"")+(i.className?i.className:"")+" "+(i.anim?"wbui-anim-"+i.anim:"")+'" '+(i.style?'style="'+i.style+'"':"")+">"+f+'<div class="wbui-cont">'+i.content+"</div>"+m+(i.closebtn?v:"")+"</div></div></div>",!i.type||2===i.type){var b=t[n](d[0]+s[i.type]);b.length>=1&&p.close(b[0].getAttribute("index"))}document.body.appendChild(c);var k=e.elem=o("#"+e.id)[0];i.success&&i.success(k),e.index=r++,e.action(i,k)},u.prototype.action=function(e,t){var o=this;e.time&&(l.timer[o.index]=setTimeout((function(){p.close(o.index)}),1e3*e.time));var i=function(){0==this.getAttribute("type")?(e.no&&e.no(),p.close(o.index)):(e.yes&&e.yes(o.index),e.whenBtnClickClose&&p.close(o.index))};if(e.btn)for(var c=t[n]("wbui-btn")[0].children,s=c.length,a=0;a<s;a++)l.touch(c[a],i);if(e.mask&&e.maskClose){var r=t[n]("wbui-mask")[0];l.touch(r,(function(){p.close(o.index,e.end)}))}if(e.closebtn){var d=t[n]("wbui-close")[0];l.touch(d,(function(){p.close(o.index,e.end)}))}e.end&&(l.end[o.index]=e.end)};const p={v:"1.0.5",index:r,open:function(e){return new u(e||{}).index},alert:function(e,t){var n="function"==typeof t,o=l.extend({content:e,btn:i});return o=n?l.extend({yes:t},o):l.extend(t,o),p.open(o)},confirm:function(e,t,n,o){var s="function"==typeof t,a=l.extend({content:e,btn:[i,c]});return a=s?l.extend({yes:t,no:n},a):l.extend(t,a),p.open(a)},toast:function(e,t){var n="function"==typeof t,o=l.extend({type:1,content:e,mask:0,closebtn:0,time:2});return o=n?l.extend({end:t},o):l.extend(t,o),p.open(o)},loading:function(e){var t="function"==typeof e,n=l.extend({type:2,content:0,mask:0,maskClose:0,closebtn:0});return n=t?l.extend({end:e},n):l.extend(e,n),p.open(n)},iframe:function(e,t,n,o){var i="function"==typeof t,c=l.extend({type:3,content:e,mask:0});return c=i?l.extend({yes:t,no:n},c):l.extend(t,c),p.open(c)},close:function(e){var n=o("#"+d[0]+e)[0];n&&(n.innerHTML="",t.body.removeChild(n),clearTimeout(l.timer[e]),delete l.timer[e],"function"==typeof l.end[e]&&l.end[e](),delete l.end[e])},closeAll:function(){for(var e=t[n](d[0]),o=0,i=e.length;o<i;o++)p.close(0|e[0].getAttribute("index"))}},y={init(){const t=this,n=document.querySelector(".wb-vk-wp");t.getQueryString("_t")&&(location.href=t.delQueryString("_t")),n&&e(n,"click",".vk-buy-verify",((e,n)=>{const o=n.dataset.post_id;return t.buy_verify(o),!1}));document.querySelector("#wpvk-buy-wp")?t.choose_buy_type():t.choose_pay_type(0)},choose_buy_type(){const t=this,n=document.querySelector("#wpvk-buy-wp"),o=document.querySelector("#wpwk-pay-wp");n&&o&&e("click",".wpvk-buy-next",((e,i)=>{const c=i.dataset.type;return n.classList.add("wpwk-def-hidden"),o.classList.remove("wpwk-def-hidden"),t.choose_pay_type(c),!1}))},choose_pay_type(t){const n=this;e("click",".wpvk-vk-pay",((e,o)=>{const i=o.dataset.vk,c=o.dataset.pay_url;return 1==t||1==i?n.no_need_login_buy(c):location.href=c,!1}))},buy_verify(e){const t=this;p.open({content:'<div class="wpvk-verify-cont no-need-login-cont">\n    <div><input class="wpvk-input" placeholder="请输入识别码" type="text" id="vk-code"/>\n    <button id="vk-submit" class="wpvk-submit-code" type="button">验证</button></div>\n    <p class="wpvk-tips">购买时设定的识别码。</p>\n</div>',title:"购买验证",className:"wbui-vk-verify",success(){const n=document.querySelector("#vk-submit"),o=document.querySelector("#vk-code");n.addEventListener("click",(()=>{const n=o.value.trim();""!=n?n.length<6?p.toast("识别码长度不少于6位。"):t.postData(vk_ajaxurl,{action:"vk_pay",_ajax_nonce:vk_ajax_nonce,post_id:e,vcode:n,op:"verify"}).then((e=>{e.code?p.toast(e.desc):location.reload()})):p.toast("请输入购买时所填写的识别码。")}))}})},no_need_login_buy(t){const n=`<div class="no-need-login-cont">\n<div><input class="wpvk-input" placeholder="输入${vk_cnf.code_min_len}-${vk_cnf.code_max_len}位${vk_cnf.code_type_name}" maxlength="24" type="text" id="vk-code"/>\n<button id="vk-submit" class="wpvk-submit-code" type="button">购买</button></div>\n<p class="wpvk-tips">识别码用于查看免登录购买付费内容。</p>\n</div>`;return p.closeAll(),p.open({content:n,title:"设定识别码后购买",className:"wbui-vk-verify",success(){const n=document.querySelector(".wbui-vk-verify");e(n,"click","#vk-submit",((e,n)=>{let o=document.querySelector("#vk-code").value.trim();o=o.replace(/[^0-9a-z]/i,"");let i=`请输入${vk_cnf.code_min_len}-${vk_cnf.code_max_len}位${vk_cnf.code_type_name}。`;return""==o||o.length<vk_cnf.code_min_len||o.length>vk_cnf.code_max_len?(p.toast("识别码长度不符。"+i),!1):("num"!=vk_cnf.code_type||/^[a-z0-9]{6,}$/i.test(o))&&("mix"!=vk_cnf.code_type||/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,}$/i.test(o))?void(location.href=t+"&type=1&vcode="+o):(p.toast("识别码类型不符。"+i),!1)}))}}),!1},getQueryString(e){const t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.href.split("?");let o=n&&n[1]?n[1].match(t):null;return null!==o?decodeURIComponent(o[2]):null},delQueryString(e,t){const n=t||window.location.href;let o,i=n.split("?")[0],c=[],s=-1!==n.indexOf("?")?n.split("?")[1]:"";if(""!==s){c=s.split("&");for(let t=c.length-1;t>=0;t-=1)o=c[t].split("=")[0],o===e&&c.splice(t,1);i=i+"?"+c.join("&")}return i},stringify(e){if("object"!=typeof e)return"";const t=[];return Object.entries(e).forEach((([e,n])=>{t.push(`${e}=${n}`)})),t.join("&")},async postData(e,t){const n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:this.stringify(t)};try{return(await fetch(e,n)).json()}catch(e){Promise.reject(e)}}};document.addEventListener("DOMContentLoaded",(()=>{y.init()}))}();