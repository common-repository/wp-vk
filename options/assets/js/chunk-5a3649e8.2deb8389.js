(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5a3649e8"],{"5b8f":function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wbs-content"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.isLoaded,expression:"!isLoaded"}],staticClass:"wbs-content-inner full",class:{"wb-page-loaded":t.isLoaded}},[a("div",{staticClass:"wbs-main"},[a("div",{staticClass:"wbs-ctrl-bar cf"},[a("el-select",{staticClass:"ctrl-item w8em",attrs:{clearable:"",placeholder:"资源类型",size:"small"},model:{value:t.q.status,callback:function(e){t.$set(t.q,"status",e)},expression:"q.status"}},t._l({1:"内容付费",2:"下载付费"},(function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})})),1),a("el-date-picker",{staticClass:"ctrl-item when-m-hide",attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small"},on:{change:t.selectDate},model:{value:t.daterange,callback:function(e){t.daterange=e},expression:"daterange"}}),a("el-input",{staticClass:"ctrl-item wbs-input-short",attrs:{placeholder:"关键词",clearable:"",size:"small"},on:{clear:t.doSearch},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.doSearch.apply(null,arguments)}},model:{value:t.q.q,callback:function(e){t.$set(t.q,"q",e)},expression:"q.q"}}),a("el-button",{staticClass:"ctrl-item",attrs:{type:"primary",plain:"",name:"search",size:"small"},on:{click:t.doSearch}},[t._v("筛选")]),a("div",{staticClass:"switch-btn align-right",on:{click:t.toggle_panel}},[t.is_expanded?a("div",[a("i",{staticClass:"el-icon-arrow-up"}),t._v(" "),a("span",[t._v("收起面板")])]):a("div",[a("i",{staticClass:"el-icon-search"}),t._v(" "),a("span",[t._v("筛选")])])])],1),t.isLoaded?a("div",{staticClass:"mt log-box"},[t.$cnf.is_mobile?a("div",{staticClass:"cell-items"},[t.list.length?t._e():a("div",{staticClass:"empty-data align-center"},[t._v(" --暂无数据-- ")]),t._l(t.list,(function(e,l){return a("div",{key:"item"+l,staticClass:"cell-item with-expand"},[a("div",{staticClass:"cell-hd"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.multipleSelection,expression:"multipleSelection"}],attrs:{type:"checkbox"},domProps:{value:e,checked:Array.isArray(t.multipleSelection)?t._i(t.multipleSelection,e)>-1:t.multipleSelection},on:{change:function(a){var l=t.multipleSelection,s=a.target,i=!!s.checked;if(Array.isArray(l)){var n=e,c=t._i(l,n);s.checked?c<0&&(t.multipleSelection=l.concat([n])):c>-1&&(t.multipleSelection=l.slice(0,c).concat(l.slice(c+1)))}else t.multipleSelection=i}}})]),a("div",{staticClass:"cell-bd primary"},[a("div",{attrs:{"data-label":"文章"}},[a("span",{staticClass:"url"},[a("a",{attrs:{href:e.post_url,target:"_blank"}},[t._v(t._s(e.post_title))])])]),a("div",{attrs:{"data-label":"已售"}},[a("router-link",{attrs:{to:"/order/"+e.ID}},[a("span",[t._v(t._s(e.sale_num))])])],1),a("div",{staticClass:"def-hide"},[a("div",{attrs:{"data-label":"类型"}},[a("span",[t._v(t._s({1:"内容付费",2:"下载付费"}[e.vk_type]))])]),a("div",{attrs:{"data-label":"价格"}},[a("span",[t._v(t._s(e.price))])]),a("div",{attrs:{"data-label":"日期"}},[t._v(t._s(e.post_date))]),a("div",{staticClass:"mt btns align-right"},[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){return t.editPrice(e)}}},[t._v("修改价格")]),a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(a){return t.cancelPay(e)}}},[t._v("取消付费")]),a("el-button",{attrs:{size:"mini",plain:""},on:{click:function(a){return t.editPost(e)}}},[t._v("编辑")])],1)])]),a("div",{staticClass:"cell-ft",on:{click:t.toggleActive}})])}))],2):a("el-table",{staticClass:"wbs-table",staticStyle:{width:"100%"},attrs:{data:t.list},on:{"sort-change":t.sortChange,"selection-change":t.handle_selection_change}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),a("el-table-column",{attrs:{label:"标题","class-name":"w35"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{"data-label":"标题"}},[a("a",{attrs:{href:e.row.post_url,target:"_blank"}},[t._v(t._s(e.row.post_title))])])]}}],null,!1,3969523619)}),a("el-table-column",{attrs:{label:"类型",align:"center","class-name":"w10"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{"data-label":"类型"}},[a("span",[t._v(t._s({1:"内容付费",2:"下载付费"}[e.row.vk_type]))])])]}}],null,!1,183587730)}),a("el-table-column",{attrs:{label:"价格",sortable:"custom","sort-by":"price",align:"center",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{"data-label":"价格"}},[a("span",[t._v(t._s(e.row.price))])])]}}],null,!1,1856573979)}),a("el-table-column",{attrs:{label:"已售",sortable:"custom","sort-by":"sale_num",align:"center",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{"data-label":"已售"}},[a("router-link",{attrs:{to:"/order/"+e.row.ID}},[a("span",[t._v(t._s(e.row.sale_num))])])],1)]}}],null,!1,2591270592)}),a("el-table-column",{attrs:{"sort-by":"post_date",label:"日期","class-name":"w10",sortable:"custom",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"wk",attrs:{"data-label":"日期"},domProps:{innerHTML:t._s(t.dateFormat(e.row.post_date))}})]}}],null,!1,600562918)}),a("el-table-column",{attrs:{label:"操作",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){return t.editPrice(e.row)}}},[t._v("修改价格")]),a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(a){return t.cancelPay(e.row)}}},[t._v("取消付费")]),a("el-button",{attrs:{size:"mini",plain:""},on:{click:function(a){return t.editPost(e.row)}}},[t._v("编辑")])]}}],null,!1,4110482166)})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.list.length>0,expression:"list.length > 0"}],staticClass:"btns-bar with-ctrl-area"},[a("div",{staticClass:"wb-ctrl-area"},[a("el-select",{attrs:{size:"small",placeholder:"批量操作"},model:{value:t.batchOp,callback:function(e){t.batchOp=e},expression:"batchOp"}},[a("el-option",{attrs:{label:"批量改价",value:"price"}}),a("el-option",{attrs:{label:"取消付费",value:"free"}})],1),a("el-button",{staticClass:"ml-s",attrs:{type:"info",plain:"",size:"small"},on:{click:t.batchApply}},[t._v("应用")])],1),a("el-pagination",{attrs:{background:"","page-size":t.num,total:1*t.total,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,30,50,100]},on:{"size-change":t.handleSizeChange,"current-change":t.navPage}})],1),a("wb-prompt",{directives:[{name:"show",rawName:"v-show",value:t.isLoaded,expression:"isLoaded"}],staticClass:"mt"})],1):t._e()])])])},s=[],i=a("5e9c");const n="WB_PLUGINS_USER_OPT_"+window.uid;var c={name:"ManagerItemsList",inject:["reload"],data(){return{isLoaded:0,cnf:{},list:[],isLoading:!0,total:0,page:1,num:30,order:"desc",daterange:[],q:{status:"",fromdate:"",todate:"",q:""},search:{},is_expanded:0,multipleSelection:[],batchOp:""}},created(){const t=this,e=Object(i["a"])(n)||{};t.num=e["PAGE_SIZE"]||30,this._getData(),this.$isPrdActive(this.$WB)},methods:{_getData(){const t=this,e={action:t.$cnf.action.act,do:"items",num:t.num};t.$api.getData(e).then(e=>{t.list=e.data,t.total=e.total,t.isLoaded=1})},handle_selection_change(t){this.multipleSelection=t},editPost(t){window.open(t.edit_url,"编辑文章-"+t.post_title)},editPrice(t){const e=this,a=`<div class="edit-cont">\n    <div class="form-group">\n      <label for="new_price">原价：&yen; <b>${t.price}</b></label>\n      <input id="new_price" class="wbs-input" type="text" placeholder="请输入新价格">\n    </div>\n</div>`;e.$wbui.open({title:"修改价格",content:a,btn:["确定","取消"],whenBtnClickClose:0,className:"wbui-edit-price",yes:function(){let a=document.querySelector("#new_price"),l=a.value.replace(/[^\d\.]/g,"");if(a.value=l,l&&(l=parseFloat(l)),!l)return e.$wbui.toast("请输入新价格"),!1;l=Math.round(100*l)/100,a.value=l;let s=e.$wbui.toast("执行中...",{time:180});e.$api.saveData({_ajax_nonce:_wb_ajax_nonce,action:e.$cnf.action.act,do:"update_item",price:l,id:t.ID}).then(t=>{e.$wbui.close(s),e.$wbui.toast("更新成功"),e.$wbui.closeAll(),e.loadList()})}})},cancelPay(t){const e=this;e.$wbui.confirm("取消付费，即取消付费内容或者付费下载设置，即用户可以免费查看内容或下载对应资源。确认取消付费？",(function(){let a=e.$wbui.toast("执行中...",{time:180});e.$api.saveData({_ajax_nonce:_wb_ajax_nonce,action:e.$cnf.action.act,do:"cancel_item",id:t.ID}).then(t=>{e.$wbui.close(a),e.$wbui.toast("已取消付费");let l=Math.ceil((e.total-1)/e.num);l<e.page&&(e.page=Math.max(1,l)),e.loadList()})}))},batchApply(){const t=this;if(!t.batchOp)return!1;if(t.multipleSelection.length<1)return t.$wbui.toast("未选择项目"),!1;if("price"==t.batchOp){let e=[];if(t.multipleSelection.forEach((function(t){e.push(t.ID)})),e.length<1)return;const a='<div class="edit-cont">\n    <div class="form-group">\n      <label for="new_price">将所选资源价格批量修改为</label>\n      <input id="new_price" class="wbs-input w8em" type="text" placeholder="请输入新价格">\n    </div>\n</div>';t.$wbui.open({title:"修改价格",content:a,btn:["确定","取消"],whenBtnClickClose:0,className:"wbui-edit-price",yes:function(){let a=document.querySelector("#new_price"),l=a.value.replace(/[^\d\.]/g,"");if(a.value=l,l&&(l=parseFloat(l)),!l)return t.$wbui.toast("请输入新价格"),!1;l=Math.round(100*l)/100,a.value=l;let s=t.$wbui.toast("执行中...",{time:180});t.$api.saveData({_ajax_nonce:_wb_ajax_nonce,action:t.$cnf.action.act,do:"update_item",price:l,id:e.join(",")}).then(e=>{t.$wbui.close(s),t.$wbui.toast("更新成功"),t.$wbui.closeAll(),t.loadList()})}})}else if("free"==t.batchOp){let e=[];if(t.multipleSelection.forEach((function(t){e.push(t.ID)})),e.length<1)return;t.$wbui.confirm("将所选付费资源批量更改为免费，即用户可以免费查看内容或下载对应资源。确定取消付费？",(function(){t.$api.saveData({_ajax_nonce:_wb_ajax_nonce,action:t.$cnf.action.act,do:"cancel_item",id:e.join(",")}).then(a=>{t.$wbui.toast("操作成功");let l=Math.ceil((t.total-e.length)/t.num);l<t.page&&(t.page=Math.max(1,l)),t.loadList()})}))}return!1},sortChange(t){if("custom"!=t.column.sortable)return;if(!t.order)return;const e=this;e.search.page=e.page,e.search.orderby=t.column.sortBy,e.search.order="ascending"==t.order?"asc":"desc",e.total>0&&e.loadList()},navPage(t){this.page=t,this.loadList()},doSearch(){this.page=1,Object.assign(this.search,this.q),this.loadList()},doFilter(t,e){const a=this;let l={};a.page=1,l[t]=e,a.q[t]=e,Object.assign(this.search,l),this.loadList()},loadList(){const t=this;t.isLoading=t.$wbui.loading();let e={action:"vk_admin",do:"items",page:t.page};Object.assign(e,t.search),t.$api.getData(e).then(e=>{t.list=e.data,t.total=e.total,t.$wbui.close(t.isLoading)})},togglePanel(){const t=this;t.$el.querySelector(".wbs-ctrl-bar").classList.toggle("expand"),t.is_expanded=!t.is_expanded},toggle_panel(){const t=this;t.$el.querySelector(".wbs-ctrl-bar").classList.toggle("expand"),t.is_expanded=!t.is_expanded},dateFormat(t){const e=t.split(" ");return e.length>1?'<span class="ib">'+e[0]+'</span> <span class="ib">'+e[1]+"</span>":t},selectDate(){const t=this;t.daterange?(t.q.fromdate=t.daterange[0],t.q.todate=t.daterange[1]):(t.q.fromdate="",t.q.todate="")},handleSizeChange(t){const e=this,a=Object(i["a"])(n)||{};e.num=t,e.page=1,a["PAGE_SIZE"]=t,Object(i["b"])(n,a),sessionStorage.clear(),e.loadList()},toggleActive(t){t.target.parentNode.classList.toggle("active")}}},o=c,r=a("2877"),d=Object(r["a"])(o,l,s,!1,null,null,null);e["default"]=d.exports},"5e9c":function(t,e,a){"use strict";a.d(e,"a",(function(){return l})),a.d(e,"b",(function(){return s}));const l=function(t,e=!1){const a=localStorage.getItem(t);if(!a)return!1;try{return e?JSON.parse(a):JSON.parse(a).data}catch(l){console.log("getLocalStorage: ",l),localStorage.removeItem(t)}},s=function(t,e){console.log("setLocalStorage",t,e);const a={ver:(new Date).getTime(),data:e},l=JSON.stringify(a);localStorage.setItem(t,l)}}}]);